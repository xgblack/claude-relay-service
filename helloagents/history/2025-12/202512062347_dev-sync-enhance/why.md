# 变更提案: dev 功能迁移增强

## 需求背景
当前 dev 分支在 main 基础上新增了调用明细查询、账户名称索引、统一调度优先级、仪表盘相对时间显示等功能，但最近一次合并 (commit 800da2a) 出现冲突点，怀疑 merge 结果存在问题。为降低后续与上游同步的冲突，希望基于 main 新建分支，以“新增文件/并行实现”为主重放 dev 功能，保持原有主干行为不变。

## 变更内容
1. 新增后端增强路由与服务：并行版 usage 统计与账户索引、OpenAI Responses 优先级处理、统一调度排序。
2. 新增前端增强视图：仪表盘相对时间、调用明细表格、增强的账户/usage 展示，以独立路由/组件形式挂载。
3. 补充分支合并复核文档与测试，确保功能隔离且可回滚。

## 影响范围
- **模块:** relay-service, admin-web
- **文件:** 新增并行版路由/服务文件，新 Vue 视图及路由项，少量入口挂载改动；文档与 CHANGELOG
- **API:** 新增/并行管理端调用明细查询接口路径
- **数据:** 复用现有 Redis 结构，新增缓存键命名约定

## 核心场景

### 需求: 调用明细查询增强
**模块:** relay-service
为管理端提供可分页的调用明细查询，支持账户名称映射与渠道区分。

#### 场景: 查询某 API Key 调用记录
请求指定 keyId，系统返回分页列表，包含账户名称、渠道、模型、状态与时间，保护总记录与单 key 上限。

### 需求: 调度与账户优先级优化
**模块:** relay-service
提供账户优先级、最近使用时间、创建时间排序的统一调度逻辑，独立于现有实现。

#### 场景: 选择下发账户
调度器按 priority > lastUsedAt > createdAt 排序选择账户，支持 OpenAI Responses/priority 逻辑。

### 需求: 仪表盘相对时间与明细视图
**模块:** admin-web
新增增强版仪表盘与调用明细页面，在不影响现有页面的情况下提供相对时间、本地时区显示与记录列表。

## 风险评估
- **风险:** 新增并行路由/视图可能与现有缓存/鉴权共享，若入口挂载不当会影响原有流量。
- **缓解:** 使用独立路径与前缀、最小化对主文件改动；逐步灰度启用，保持原路由默认关闭；增加测试覆盖与回滚路径。
